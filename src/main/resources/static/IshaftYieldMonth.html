<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <link rel="icon" href="images/favicon.ico">
    <title>Nexteer</title>
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="css/bs-docs.css" type="text/css">
    <link rel="stylesheet" href="css/mainboard.css" type="text/css">
    <link rel="stylesheet" href="css/dropdown.css" type="text/css">
    <link rel="stylesheet" href="css/height.css" type="text/css">
    <link rel="stylesheet" href="css/sheetTable.css" type="text/css">
    <style type="text/css">
        body {
            background-color: #F7F7F7;
        }
        .main{
            width: 100%;
            margin:0 0 0 3% ;
            padding: 0 0 0 2%;
            box-sizing: border-box;
        }

        .main .item {
            margin: 0 2% 2% 0;
            position: relative;
            background-color: #FFF;
            float: left;
            /*box-shadow: 2px 2px 5px #CCC;*/
            height: 100%;
        }
        .item2{
            width: 93.75%;
        }
        .row{
            height: 100%;
        }
        .border-line{
            border: 1px solid #293c55;
        }

    </style>

</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://10.1.0.40:8080/nexteer/index.html"><img src="images/icon.png" alt="Nexteer"></a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <p class="navbar-text">产量信息展示I-shaft1月视图</p>
            <ul class="nav navbar-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">VSS-Ishaft <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-submenu"><a href="#">I-shaft1</a>
                            <ul class="dropdown-menu pull-right">
                                <li><a href="http://10.1.0.40:8080/nexteer/IshaftYieldWeek.html">周视图</a></li>
                                <li><a href="http://10.1.0.40:8080/nexteer/IshaftYieldMonth.html">月视图</a></li>
                                <li><a href="http://10.1.0.40:8080/nexteer/IshaftYieldYear.html">年视图</a></li>
                            </ul>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li class="dropdown-submenu"><a href="#">I-shaft2</a>
                            <ul class="dropdown-menu pull-right">
                                <li><a href="#">周视图</a></li>
                                <li><a href="#">月视图</a></li>
                                <li><a href="#">年视图</a></li>
                            </ul>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li class="dropdown-submenu"><a href="#">I-shaft3</a>
                            <ul class="dropdown-menu pull-right">
                                <li><a href="#">周视图</a></li>
                                <li><a href="#">月视图</a></li>
                                <li><a href="#">年视图</a></li>
                            </ul>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li class="dropdown-submenu"><a href="#">I-shaft4</a>
                            <ul class="dropdown-menu pull-right">
                                <li><a href="#">周视图</a></li>
                                <li><a href="#">月视图</a></li>
                                <li><a href="#">年视图</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">BEPS <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-submenu"><a href="#">Cell1</a>
                            <ul class="dropdown-menu pull-right">
                                <li><a href="#">周视图</a></li>
                                <li><a href="#">月视图</a></li>
                                <li><a href="#">年视图</a></li>
                            </ul>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li class="dropdown-submenu"><a href="#">Cell2</a>
                            <ul class="dropdown-menu pull-right">
                                <li><a href="#">周视图</a></li>
                                <li><a href="#">月视图</a></li>
                                <li><a href="#">年视图</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">CEPS <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-submenu"><a href="#">Cell1</a>
                            <ul class="dropdown-menu pull-right">
                                <li><a href="#">周视图</a></li>
                                <li><a href="#">月视图</a></li>
                                <li><a href="#">年视图</a></li>
                            </ul>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li class="dropdown-submenu"><a href="#">Cell2</a>
                            <ul class="dropdown-menu pull-right">
                                <li><a href="#">周视图</a></li>
                                <li><a href="#">月视图</a></li>
                                <li><a href="#">年视图</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>

            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>
<div class="main">
    <div class="row">
        <div class="col-md-8 item  " id="IshaftOneYieldMonthBar"></div>
        <div class="col-md-3 item " id="IshaftOneYieldMonthPie"></div>
    </div>

</div>


<script src="bower_components/jquery/dist/jquery.min.js" ></script>
<script src="bower_components/jquery-json/dist/jquery.json.min.js"></script>
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="bower_components/echarts/dist/echarts.min.js"></script>
<script src="js/defineGlobal.js"></script>
<script type="application/javascript">
    //获取Ishaft1的周数据ajax请求函数
    function judgeMyTime(time) {
        var timeStr="";
        if (time<10){
            timeStr="0"+time.toString()
        }
        else {
            timeStr=time.toString()
        }
        return timeStr;
    }
    function endTime(endTime) {
        this.end_time = endTime;
    }
    var getIshaftOneMonthJson= new endTime(Uyear+"-"+judgeMyTime(Umonth)+"-"+judgeMyTime(Uday));
//    var getIshaftOneMonthJson =new endTime("2017-04-08");
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('IshaftOneYieldMonthBar'));
    var myPieChart = echarts.init(document.getElementById('IshaftOneYieldMonthPie'));
    //    var myDataOne= [];
    //    var worker = new Worker('http://10.1.0.40:8080/nexteer/IshaftYieldWeekFirstWork.js');

    function getIshaftOneMonthData() {
        var proIDMsg=[];
        var proNameMsg=[];
        var myData=[];
        var myAjaxData=[];
        var sum=[];
        var myPieData=[];
        var perCent=50;
        for(var i=0;i<30;i++){    //一维长度为i,i为变量，可以根据实际情况改变
            myData[i]=[];  //声明二维，每一个一维数组里面的一个元素都是一个数组；
            sum[i]=0;
            for(var myJ=0;myJ<31;myJ++){
                myData[i][myJ]=0;
            }
        }
        var myXDate=[];
        for(var jX=0;jX<30;jX++){    //一维长度为i,i为变量，可以根据实际情况改变
            myXDate[jX]=[];  //声明二维，每一个一维数组里面的一个元素都是一个数组；
        }
        var MonthDate=[];
        var d=new Date(Uyear,Umonth,0);
        for(var Mindex=1;Mindex<d.getDate()+1;Mindex++){
            MonthDate.push(Uyear+"-"+judgeMyTime(Umonth)+"-"+judgeMyTime(Mindex))
        }
        console.log("当前月份天数"+MonthDate);



        $.get("http://10.1.0.40:8080/nexteer/product-model", function (data) {
            $.each(data, function (i, model) {
                if(model.cellName=="Ishaft1"){
//                    ProMsg.push({"modelId":model.modelId,"modelName":model.modelName})
                    proIDMsg.push(model.modelId);
                    proNameMsg.push(model.modelName);
                }
            });
        });
        $.ajax({
            type: "POST",
            url: "http://10.1.0.40:8080/nexteer/output-info/getByMonth",
            data: JSON.stringify(getIshaftOneMonthJson),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                myAjaxData = JSON.stringify(data);
                for(var j=0,len=proIDMsg.length;j<len;j++){
//                    for(var myIndex = 0,myLen = myAjaxData.length;myIndex<myLen;myIndex++){
//                        if(myAjaxData[myIndex].)
//                        myData[j].push({"add_date":myAjaxData[myIndex].add_date,"output_count":myAjaxData[myIndex].output_count});
//                    }
                    $.each(data,function (index,model) {
                        if(data[index].model==proIDMsg[j]){
                            for(var MDIndex=0;MDIndex<31;MDIndex++){
                                if (data[index].add_date==MonthDate[MDIndex]){
                                    myData[j][MDIndex]=data[index].output_count;
                                    sum[j]+=data[index].output_count;
                                    perCent = 100*MDIndex/31
                                }

                            }
//                            myXDate[j].push(data[index].add_date);
//                            myData[j].push(data[index].output_count);
//                            myData[j].push(data[index].output_count);
                        }

                    })
                }
//                for(var jD=0,jLen = myData[iD].length;jD<jLen;jD++){
//                }
//                for(var iD=0;iD<30;iD++){
//
//                }
                for(var sumIndex=0;sumIndex<proNameMsg.length;sumIndex++){
                    myPieData[sumIndex]={value:sum[sumIndex],name:proNameMsg[sumIndex]};
                }
                var myTitle= {
                    text: 'Ishaft1产量信息展示（月视图）',
                    left:'40%',
                    textStyle:{
                        fontSize:24
                    }
                };


                var myYaxis= [{
                    type:'value',
                    name:'产品数（件）',
                    position:'left',
                    nameTextStyle:{
                        fontStyle:'normal',
                        fontWeight:'bold',
                        fontSize:'20'
                    },
                    axisLabel:{
                        textStyle:{
                            fontSize:20
                        }
                    }
                }];
                var myGrid= {
                    containLabel: true,
                    left:'4%',
                    right:'5%',
                    bottom:'2%'
                };
                var myLengend = {
                    data:[],
                    align: 'right',
                    right: '9%',
                    top:'6%'
                };
                myLengend.data=proNameMsg;
                var sData=[];
                for(var pI in proNameMsg){
                    sData[pI]={name:proNameMsg[pI],type:'line',smooth: true,
                        showAllSymbol: true,
                        symbol: 'emptyCircle',data:myData[pI]};
                }
                console.log(sData);
//                var mySeriesData =  [{
//                    name: 'F102',
//                    type: 'bar',
//                    data: [20, 12, 31, 34, 31]
//                }, {
//                    name: 'R103',
//                    type: 'bar',
//                    data: [10, 20, 5, 9, 3]
//                }, {
//                    name: 'H50',
//                    type: 'bar',
//                    data: [1, 1, 2, 3, 1]
//                }];

                option = {
                    title: myTitle,
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: { // 坐标轴指示器，坐标轴触发有效
                            type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
                        }
                    },
                    toolbox: {
                        feature: {
                            dataView: {
                                show: true,
                                readOnly: false,
                                optionToContent: function (opt) {
                                    var axisData = opt.xAxis[0].data;
                                    var series = opt.series;
                                    var table = '<table class="table" style="width:100%;text-align:center"><tbody><tr><td>时间/型号</td>';
                                    for (var i = 0, l = series.length; i < l; i++){
                                        table += '<td>' + series[i].name+ '</td>'

                                    }
                                    table += '</tr>';
                                    for (var j = 0, len = axisData.length; j < len; j++) {
                                        table += '<tr>'
                                            + '<td>' + axisData[j] + '</td>';
                                        for(var k=0,secLen = series.length;k<secLen;k++){
                                            if(series[k].data[j]==undefined){
                                                table +='<td>'+'</td>'
                                            }
                                            else {
                                                table += '<td>' + series[k].data[j] + '</td>'
                                            }

                                        }
                                        table +='</tr>';
                                    }
                                    table += '</tbody></table>';
                                    return table;
                                }
                            },
                            saveAsImage: {
                                show: true
                            }
                        }
                    },
                    legend: myLengend,
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: [{
                        type: 'category',
                        data: MonthDate
                    }],
                    yAxis: myYaxis,
                    dataZoom: [
                        {
                            id: 'dataZoomX',
                            type: 'slider',
                            xAxisIndex: [0],
                            filterMode: 'filter', // 设定为 'filter' 从而 X 的窗口变化会影响 Y 的范围。
                            start: 1,
                            end: perCent
                        }],
                    series: sData
                };
                pieOption= {
                    title : {
                        text: '产量信息展示当月',
//            subtext: '纯属虚构',
                        x:'right'
                    },
                    tooltip : {
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    legend: {
                        orient: 'vertical',
                        left: 'left',
                        data: proNameMsg
                    },
                    series : [
                        {
                            name: 'Ishaft1',
                            type: 'pie',
                            radius : '55%',
                            center: ['50%', '60%'],
                            data:myPieData,
                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };
                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
                myPieChart.setOption(pieOption);

                console.log(proNameMsg);
                console.log(proIDMsg);
                console.log(myData);
                console.log(myAjaxData);
            },
            failure: function (errMsg) {
                console.log(errMsg);
            }
        });
    }
    getIshaftOneMonthData();


</script>
<!--<script type="application/javascript">-->
    <!--// 基于准备好的dom，初始化echarts实例-->
    <!--var myBarChart = echarts.init(document.getElementById('IshaftOneYieldMonthBar'));-->
    <!--var myPieChart = echarts.init(document.getElementById('IshaftOneYieldMonthPie'));-->
<!--//    barOption = {-->
<!--//        title: {-->
<!--//            text: 'Ishaft1产量信息展示月视图'-->
<!--////            subtext: '数据来自网络'-->
<!--//        },-->
<!--//        tooltip: {-->
<!--//            trigger: 'axis',-->
<!--//            axisPointer: {-->
<!--//                type: 'shadow'-->
<!--//            }-->
<!--//        },-->
<!--//        legend: {-->
<!--//            data: ['F102', 'R103','H50']-->
<!--//        },-->
<!--//        grid: {-->
<!--//            left: '3%',-->
<!--//            right: '4%',-->
<!--//            bottom: '3%',-->
<!--//            containLabel: true-->
<!--//        },-->
<!--//        xAxis: {-->
<!--//            type: 'value',-->
<!--//            boundaryGap: [0, 0.01]-->
<!--//        },-->
<!--//        yAxis: {-->
<!--//            type: 'category'-->
<!--//            ,-->
<!--//            data: ['类别一']-->
<!--//        },-->
<!--//        series: [-->
<!--//            {-->
<!--//                name: 'F102',-->
<!--//                type: 'bar',-->
<!--//                data: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]-->
<!--//            },-->
<!--//            {-->
<!--//                name: 'R103',-->
<!--//                type: 'bar',-->
<!--//                data: [2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]-->
<!--//            },-->
<!--//            {-->
<!--//                name: 'H50',-->
<!--//                type: 'bar',-->
<!--//                data: [3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]-->
<!--//            }-->
<!--//        ]-->
<!--//    };-->

    <!--var myTitle= {-->
        <!--text: 'Ishaft1产量信息展示（月视图）',-->
        <!--left:'40%',-->
        <!--textStyle:{-->
            <!--fontSize:24-->
        <!--}-->
    <!--};-->


    <!--var myYaxis= [{-->
        <!--type:'value',-->
        <!--name:'产品数（件）',-->
        <!--position:'left',-->
        <!--nameTextStyle:{-->
            <!--fontStyle:'normal',-->
            <!--fontWeight:'bold',-->
            <!--fontSize:'20'-->
        <!--},-->
        <!--axisLabel:{-->
            <!--textStyle:{-->
                <!--fontSize:20-->
            <!--}-->
        <!--}-->
    <!--}];-->
    <!--var myGrid= {-->
        <!--containLabel: true,-->
        <!--left:'4%',-->
        <!--right:'5%',-->
        <!--bottom:'2%'-->
    <!--};-->
    <!--var myLengend = {-->
        <!--data:['F102', 'R103', 'H50'],-->
        <!--align: 'right',-->
        <!--right: '9%',-->
        <!--top:'6%'-->
    <!--};-->
    <!--barOption = {-->
        <!--title: myTitle,-->
        <!--tooltip: {-->
            <!--trigger: 'axis',-->
            <!--axisPointer: { // 坐标轴指示器，坐标轴触发有效-->
                <!--type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'-->
            <!--}-->
        <!--},-->
        <!--toolbox: {-->
            <!--feature: {-->
                <!--dataView: {-->
                    <!--show: true,-->
                    <!--readOnly: false,-->
                    <!--optionToContent: function (opt) {-->
                        <!--var axisData = opt.xAxis[0].data;-->
                        <!--var series = opt.series;-->
                        <!--var table = '<table class="table" style="width:100%;text-align:center"><tbody><tr>'-->
                            <!--+ '<td>时间</td>';-->
                        <!--for(var j = 0,seLen= series.length;j<seLen;j++){-->
                            <!--table += '<td>' + series[j].name + '</td>';-->
                        <!--}-->
                        <!--table +='</tr>';-->
                        <!--for (var i = 0, l = axisData.length; i < l; i++) {-->
                            <!--table += '<tr>'-->
                                <!--+ '<td>' + axisData[i] + '</td>';-->
                            <!--for(var k=0,tLen=series.length;k<tLen;k++){-->
                                <!--table +='<td>' + series[k].data[i] + '</td>';-->

                            <!--}-->
                            <!--table +='</tr>';-->
                        <!--}-->
                        <!--table += '</tbody></table>';-->
                        <!--return table;-->
                    <!--}-->
                <!--},-->
                <!--saveAsImage: {-->
                    <!--show: true-->
                <!--}-->
            <!--}-->
        <!--},-->
        <!--legend: myLengend,-->
        <!--grid: {-->
            <!--left: '3%',-->
            <!--right: '4%',-->
            <!--bottom: '3%',-->
            <!--containLabel: true-->
        <!--},-->
        <!--xAxis: [{-->
            <!--type: 'category',-->
            <!--data: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]-->
        <!--}],-->
        <!--yAxis: myYaxis,-->
        <!--series: [{-->
            <!--name: 'F102',-->
            <!--type: 'line',-->
            <!--data: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]-->
        <!--}, {-->
            <!--name: 'R103',-->
            <!--type: 'line',-->
            <!--data: [3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]-->
        <!--}, {-->
            <!--name: 'H50',-->
            <!--type: 'line',-->
            <!--data: [5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35]-->
        <!--}]-->
    <!--};-->

    <!--pieOption= {-->
        <!--title : {-->
            <!--text: '产量信息展示当月',-->
<!--//            subtext: '纯属虚构',-->
            <!--x:'right'-->
        <!--},-->
        <!--tooltip : {-->
            <!--trigger: 'item',-->
            <!--formatter: "{a} <br/>{b} : {c} ({d}%)"-->
        <!--},-->
        <!--legend: {-->
            <!--orient: 'vertical',-->
            <!--left: 'left',-->
            <!--data: ['F102','R103','H50']-->
        <!--},-->
        <!--series : [-->
            <!--{-->
                <!--name: 'F102',-->
                <!--type: 'pie',-->
                <!--radius : '55%',-->
                <!--center: ['50%', '60%'],-->
                <!--data:[-->
                    <!--{value:1500, name:'F102'},-->
                    <!--{value:1400, name:'R103'},-->
                    <!--{value:1700, name:'H50'}-->

                <!--],-->
                <!--itemStyle: {-->
                    <!--emphasis: {-->
                        <!--shadowBlur: 10,-->
                        <!--shadowOffsetX: 0,-->
                        <!--shadowColor: 'rgba(0, 0, 0, 0.5)'-->
                    <!--}-->
                <!--}-->
            <!--}-->
        <!--]-->
    <!--};-->
    <!--// 使用刚指定的配置项和数据显示图表。-->
    <!--myBarChart.setOption(barOption);-->
    <!--myPieChart.setOption(pieOption);-->
<!--</script>-->
</body>
</html>